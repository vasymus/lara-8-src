## TODO:
## make app 3 in 1: php-fpm + nginx + supervisord (like in php good defaults)
## use traefik proxy to docker-compose to proxy adminer, redis, redis webui, mailhog

version: '2.4'
# version 2.x allows you to use depends_on with conditions that cause
# the node app to wait on mongo to respond to a healthy healthcheck before node is started
# v3.x doesn't have this feature yet, and is only needed if you want to use Swarm

services:
    ### APP (php-fpm) ##############################################
    app:
        build:
            context: ./docker/app
        volumes:
            - ./docker/app/php.ini:/usr/local/etc/php/php.ini
            - ./docker/app/supervisor-logs:/var/log
            - .:/var/www/html:delegated

    ### DB (MariaDB) ##############################################
    db:
        build:
            context: ./docker/mariadb
        restart: always
        volumes:
            - db-data:/var/lib/mysql
            - ./docker/mariadb/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d
        environment:
            - MYSQL_USER=${DOCKER_MARIADB_USER}
            - MYSQL_PASSWORD=${DOCKER_MARIADB_PASSWORD}
            - MYSQL_ROOT_PASSWORD=root
            - TZ=UTC
        expose:
            - "3306"
        networks:
            - "${DOCKER_NETWORK}"
